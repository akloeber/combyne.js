(function(a,b){typeof exports=="object"?(module.exports=b(),module.exports.compile=function(a){return function(b){return module.exports(a,b).render()}}):typeof define=="function"&&define.amd?define(b):a.combyne=b()})(this,function(){function g(a,d,e,h){var i,j,k,l=e.pop(),m=l.captures[0];switch(l.name){case"WHITESPACE":f.push("'"+m+"'");break;case"COMMENT":c==="START_EXPR"?f.push("/*"):b==="END_EXPR"?f.push("*/"):f.push("'"+h.COMMENT+"'");break;case"OTHER":c==="START_PROP"?f.push("typeof "+m+" == 'function' ? "+m+"() : "+m):f.push("'"+m+"'")}return e.length?(c=l.name,b=e[0].name,g(a,d,e,h)):f}function h(a){var b=this;return function(){return a.apply({original:b.template},arguments)}}function i(a){return a.replace(e,"\\$&")}function j(a){var b,c=[];for(b in a){if(!a.hasOwnProperty(b))continue;c.push(b)}return c}function k(a){var b,c,d=0,e=arguments.length;while(++d<e){c=arguments[d];for(b in c)a[b]=c[b]}return a}function l(a){var b,c="";for(b=0;b<a.length;b++)c+="stack.push("+(typeof a[b]=="string"?"unescape("+escape(a[b])+")":a[b])+");";return new Function("data, contents",["var stack = [];","try {","with (data || {}) {",a.join(""),"}","} catch (ex) {};","return stack.join('');"].join("\n"))}function m(b,c,d){a=d=d||a;var e,f,g,h,i=j(d),k=i.length;while(b.length)for(e=0;e<k;e++){h=i[e];if(f=d[h].exec(b))g={name:h,captures:f},b=b.replace(d[h],""),f[0]&&c.push(g)}}function n(a,b,c,d){var e,f,h,j,k,l,n,o=0,p=[],q={};f=i(d.START_PROP),h=i(d.END_PROP),j=i(d.START_EXPR),k=i(d.END_EXPR),l=i(d.COMMENT),n=i(d.FILTER),q.START_PROP=new RegExp("^"+f),q.END_PROP=new RegExp("^"+h),q.START_EXPR=new RegExp("^"+j),q.END_EXPR=new RegExp("^"+k),q.COMMENT=new RegExp("^"+l),q.FILTER=new RegExp("^"+n),e=[f,h,j,k,l,n].join("|"),q.WHITESPACE=/^[\ |\t|\r|\n]+/,q.OTHER=new RegExp("^((?!"+e+").)*");if(o=m(b,p,q))if(a.debug)throw new Error(o);return p.reverse(),g(a,c,p,d)}function o(a,b){function c(){return{_cache:{},get:function(a){return this._cache[a]},remove:function(a){delete this._cache[a]}}}if(this instanceof o)this.template=a,this.context=b||{},this.filters=c(),this.filters.add=function(a,b){this._cache[a]=h(b)},this.partials=c(),this.partials.add=function(a,b,c){this._cache[a]={template:b,context:c}};else return new o(a,b)}var a,b,c,d=Object.prototype.toString,e=/[\^$\\\/.*+?()\[\]{}|]/g,f=[];return o.VERSION="0.3.0",o.prototype={render:function(a){var d=this;d.context=a||d.context;if(!d.template||!d.context)if(d.debug)throw new Error("Missing template or context");d.delimiters=k({},d.delimiters,{START_PROP:"{{",END_PROP:"}}",START_EXPR:"{%",END_EXPR:"%}",COMMENT:"--",FILTER:"|"});var e=n(d,d.template,d.context,d.delimiters);return f=[],b="",c="",l(e)(d.context)},delimiters:{}},o});